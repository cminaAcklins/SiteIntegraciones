@model Integraciones.Models.IdentificacionViewModel
@{
    ViewData["Title"] = "Crear Identificacion";
}

<div class="container mt-5">
    <h2>Crear Identificación</h2>

 @*    @if (!ViewData.ModelState.IsValid)
    {
        var allErrors = ViewData.ModelState.Values.SelectMany(v => v.Errors).Select(e => e.ErrorMessage).ToList();
        if (allErrors.Any())
        {
            <div class="alert alert-danger" role="alert">
                @foreach (var error in allErrors)
                {
                    <p>@error</p>
                }
            </div>
        }
    } *@

    @if (ViewBag.Message != null)
    {
        var alertClass = ViewBag.MessageType == "success" ? "alert-success" : "alert-danger";
        var iconClass = ViewBag.MessageType == "success" ? "bi bi-check-circle-fill" : "bi bi-exclamation-triangle-fill";

        <div id="alertMessage" class="alert @alertClass mt-3 text-center fw-bold d-flex align-items-center justify-content-center gap-2" role="alert">
            <i class="@iconClass"></i>
            <span>@ViewBag.Message</span>
        </div>
    }

    <form asp-action="Create" method="post" id="formCrear">

        <div class="mb-3">
            <label asp-for="txtTipoIdentificacion" class="form-label"></label>
            <select asp-for="txtTipoIdentificacion" class="form-select" asp-items="ViewBag.TiposIdentificacion" id="txtTipoIdentificacion">
                <option value="">-- Seleccione --</option>
            </select>
            <span asp-validation-for="txtTipoIdentificacion" class="text-danger"></span>
        </div>


        <div class="mb-3">
            <label asp-for="txtIdentificacion" class="form-label">Número de Cédula/RUC</label>
            <input asp-for="txtIdentificacion"
                   class="form-control"
                   id="txtIdentificacion"
                   inputmode="numeric"
                   autocomplete="off" />
            <span id="identificacionError" class="text-danger"></span>
        </div>

        <div class="mb-3">
            <label asp-for="txtNombresApellidos" class="form-label"></label>
            <input asp-for="txtNombresApellidos" class="form-control" />
            <span asp-validation-for="txtNombresApellidos" class="text-danger"></span>
        </div>

        <div class="mb-3 form-check">
            <input asp-for="txtestado" class="form-check-input" type="checkbox" checked />
            <label asp-for="txtestado" class="form-check-label">Activo</label>
        </div>
        <div class="mb-3 form-check">
            <input asp-for="bdVerificado"  class="form-check-input" type="checkbox" checked />
            <label asp-for="bdVerificado" class="form-check-label">Verificado</label>
        </div>

        <button type="submit" class="btn btn-success" id="btnCrear">
            <i class="bi bi-save"></i> Crear
        </button>
        <a asp-action="Index" class="btn btn-secondary ms-2">
            <i class="bi bi-arrow-left-circle"></i> Volver
        </a>
    </form>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const form = document.getElementById("formCrear");
            const btn = document.getElementById("btnCrear");

            if (form && btn) {
                form.addEventListener("submit", function () {
                    btn.disabled = true;
                    btn.innerHTML = '<span class="spinner-border spinner-border-sm"></span> Guardando...';
                });
            }
        });

        const tipo = document.getElementById("txtTipoIdentificacion");
        const identificacion = document.getElementById("txtIdentificacion");
        const errorSpan = document.getElementById("identificacionError");

        function validarIdentificacion() {
            // 🔹 Solo números
            identificacion.value = identificacion.value.replace(/\D/g, '');

            let maxLength = 0;
            let mensaje = "";

            if (tipo.value === "C") {
                maxLength = 10;
                mensaje = "La cédula debe tener 10 dígitos";
            }
            else if (tipo.value === "R") {
                maxLength = 13;
                mensaje = "El RUC debe tener 13 dígitos";
            }

            if (maxLength > 0) {
                identificacion.maxLength = maxLength;

                if (identificacion.value.length > maxLength) {
                    identificacion.value = identificacion.value.slice(0, maxLength);
                }

                if (identificacion.value.length > 0 &&
                    identificacion.value.length < maxLength) {
                    errorSpan.textContent = mensaje;
                } else {
                    errorSpan.textContent = "";
                }
            } else {
                identificacion.removeAttribute("maxlength");
                errorSpan.textContent = "";
            }
        }

        tipo.addEventListener("change", validarIdentificacion);
        identificacion.addEventListener("input", validarIdentificacion);




    </script>
}


   @*  <script>
        // Si hay mensaje de éxito, redirigir después de 2 segundos
        const alert = document.getElementById('alertMessage');
        if (alert && alert.classList.contains('alert-success')) {
            setTimeout(() => {
                window.location.href = '@Url.Action("Index", "Identificacion")';
            }, 2000); // 2 segundos
        }
    </script> *@

